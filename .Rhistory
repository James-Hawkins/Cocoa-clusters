) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="T-test p value \n", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.9))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg.b
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = '\n\n\np-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="T-test p value \n", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.9))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg.b
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.9))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg.b
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.0))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg.b
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\n\n\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.0))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg.b
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\n\n\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.0))
, legend.position = c(0.04, -0.135)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg <<- annotate_figure( fig.cor.interg.b ,   fig.lab = "a", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.intrag <<- annotate_figure( fig.cor.intrag.b ,   fig.lab = "b", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.plot   <<- plot_grid(  fig.cor.interg,
fig.cor.intrag,
#  align = "v",
nrow = 1,
ncol = 2 ,
rel_widths = c(20/100, 52/100)
)
ggsave("fig.cor.plot.pdf",    fig.cor.plot    , path = "Figures.out", width=900, height= 750, units="px", scale=2.5  )
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\n\n\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.0))
, legend.position = c(0.04, -0.10005)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg <<- annotate_figure( fig.cor.interg.b ,   fig.lab = "a", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.intrag <<- annotate_figure( fig.cor.intrag.b ,   fig.lab = "b", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.plot   <<- plot_grid(  fig.cor.interg,
fig.cor.intrag,
#  align = "v",
nrow = 1,
ncol = 2 ,
rel_widths = c(20/100, 52/100)
)
ggsave("fig.cor.plot.pdf",    fig.cor.plot    , path = "Figures.out", width=900, height= 750, units="px", scale=2.5  )
fig.cor.interg.b <<- ggplot( data = cor.interg[ !is.na(cor.interg$var.v) &  !is.na(cor.interg$var.s.c) , ] ,aes(  y = variable.label ,  x = as.factor(typology)))+
geom_point(shape = cor.plot.point.shape.id ,  stroke = 0.025 ,   size = 5 , aes( alpha =  var.s.c , y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
geom_point(shape = cor.plot.point.shape.id,  stroke = 0.025 , alpha =  corr.plot.base.alpha,  size = 5 , aes(  y = variable.label  ,  fill = factor(dir.d.str)) , stat = 'identity') +
# geom_point(shape = 22, stroke = 1,  alpha = 1 , size = 5 , aes(  x = variable.label  , color = dir.d ) , stat = 'identity') +
scale_fill_manual(values=c(  dir.d.pos.color  , dir.d.neg.color),
name = 'Direction\nof change')  +
scale_alpha_continuous( name = 'p-value',
breaks = c( 0.01 , 0.1 , 0.5 , 0.999  ),
range = c( 1.0 , 0.0 ),
labels = c('0.01' , '0.025' , '0.05' , '>= 0.1') ,
limits= c( 0.0 , 1.0)
) +
#  facet_grid( typology  ~  variable.cat  , scales = 'free_y' ,  space='free_y' ,  switch = "y" ) +
facet_grid( variable.cat ~  Facet.label   , scales = 'free' ,  space='free' ,  switch = "y"  , labeller = label_wrap_gen(width=15)) +
# facet_grid( .   ~ variable.cat   , scales = 'free_x' ,  space='free_x') +
# geom_point(shape = 21, stroke = 0) +
scale_y_discrete(position = "right" , limits = rev) +
scale_x_discrete(
# limits = c(1,8) ,
#  breaks = seq(1, 8, by = 1) ,
#  labels = var.labels
) +
ylab('')  +
xlab('')  +
guides(
fill = guide_legend(
title=
"Direction\nof\nchange\n(relative\nto\nmean) ", order=1 , nrow = 2 , title.position = 'top'),
alpha = guide_legend(title="\n\n\n\n\nT-test p value", order=2 , nrow = 2 , title.hjust = .5 ,title.position = 'top')
) +
# guides(colour = guide_legend(nrow = 1, title.position = "top" ,  byrow = T, override.aes=list(size=4))) +
# guides(size = guide_legend(nrow = 1, byrow = T)) +
# guides(size = guide_legend(nrow=2,byrow=TRUE , legend.position = 'bottom' , title.position="top", title.hjust = 0.5))+
theme(
plot.margin = unit(c(p.corr.interg.mg.top , p.corr.interg.mg.right , p.corr.interg.mg.bottom , p.corr.interg.mg.left), "cm"),
strip.text = element_text(size =  9.5, color = 'black'),
strip.text.y.left = element_text(angle = 0),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1),
axis.ticks.y = element_blank(),
axis.text.x = element_text(size = cor.plot.x.tx.fs , angle=90 , vjust = 0.5, hjust=1),
axis.text.y = element_blank(),
# element_text(size = 9 ,  vjust = 0.5, hjust=0 , face = 'italic'),
axis.ticks.x = element_blank()
#  , legend.position = "bottom"
,  legend.key.height = unit(intrag.leg.key.h.ghg*.5, 'cm')
, legend.key.width = unit(intrag.leg.key.w.ghg*.5, 'cm')
, legend.title = element_text(size = 7.0)
,   legend.box="horizontal"
, legend.spacing.y = unit(.1, 'cm')
#  plot.title.position = "plot",
, legend.background = element_rect(fill = alpha('white', 0.0))
, legend.position = c(0.04, -0.060005)
,  legend.key = element_rect(fill = "white")
,legend.justification = c("center", "top")
, legend.text = element_text(size=7)
)
fig.cor.interg <<- annotate_figure( fig.cor.interg.b ,   fig.lab = "a", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.intrag <<- annotate_figure( fig.cor.intrag.b ,   fig.lab = "b", fig.lab.pos ="top.left", fig.lab.size = corr.plot.label.fs )
fig.cor.plot   <<- plot_grid(  fig.cor.interg,
fig.cor.intrag,
#  align = "v",
nrow = 1,
ncol = 2 ,
rel_widths = c(20/100, 52/100)
)
ggsave("fig.cor.plot.pdf",    fig.cor.plot    , path = "Figures.out", width=900, height= 750, units="px", scale=2.5  )
fig.cor.plot   <<- plot_grid(  fig.cor.interg,
fig.cor.intrag,
#  align = "v",
nrow = 1,
ncol = 2 ,
rel_widths = c(20/100, 52/100)
)
ggsave("fig.cor.plot.pdf",    fig.cor.plot    , path = "Figures.out", width=900, height= 750, units="px", scale=2.5  )
