v10.dat <-  v10.dat[ -c(1)]
v11.dat <-  v10.dat[ -c(1)]
typ.dat <- cbind(
v.name.dat,
v0.dat,
v1.dat,
v2.dat,
v3.dat,
v4.dat,
v5.dat,
v6.dat,
v7.dat,
v8.dat,
v9.dat,
v10.dat,
v11.dat
)
pract.dat <- rbind(pract.dat,typ.dat)
#  View(pract.dat)
}
pract.dat <- na.omit(pract.dat)
pract.dat <- pract.dat[-c(1),]
colnames(pract.dat) = c(
'Cluster',
'n',
'N-fert (kg/ha/yr)',
'Non N-fert (kg/ha/yr)',
'Pruning (#/yr)',
'Weeding (#/yr)',
'Pollination (dummy)',
'Insecticide (dummy)',
'Fungicides (dummy)',
'Herbicides (dummy)',
'Blackpod detection rate (%)',
'Capsid detection rate (%)',
'Stemborer detection rate (%)'
)
#pract.dat <<-  na.omit(pract.dat[])
path_out = '.\\Figures.out\\'
fileName = paste(path_out, 'table_typology.pract.csv',sep = '')
write.csv.utf8.BOM(  pract.dat  ,   file = fileName)  # Export
}
tb.typ.pract()
tb.typ.clim <- function(){
typologies <- c(
'Hybrid sun',
'Hybrid shade',
'Amazonia'
)
cli.dat <- data.frame()
cli.dat <- 0
for (T in typologies){
v1 <- 'precip'
v2 <- 'temp.mmm'
v3 <- 'elev'
v4 <- 'water.log.bool'
v0.dat <- data.frame()
v1.dat <- data.frame()
v2.dat <- data.frame()
v3.dat <- data.frame()
v4.dat <- data.frame()
v5.dat <- data.frame()
v0.dat <- 0
v1.dat <- 0
v2.dat <- 0
v3.dat <- 0
v4.dat <- 0
v5.dat <- 0
comp$typ <- as.numeric((comp$typ))
insert <<- " \u00B1 "
if (T == "Hybrid sun") {  clust.quant <- num.clusts.hysn}
if (T == "Hybrid shade") {  clust.quant <- num.clusts.hysh}
if (T == "Amazonia") {  clust.quant <- num.clusts.amz}
for ( t in 1:clust.quant){
tp <- t
ids <- comp[!is.na(comp$typ.str) & comp$typ.str == tp & (comp$typology == T) , 'hhID']
# Variable 0
v0 <- nrow( comp[(comp$hhID %in% ids ) , ] )
v0.dat <- append(v0.dat ,  v0 )
# Variable 1
v1.m <- mean( na.omit(T.df[(T.df$hhID %in% ids ) , v1] ))
v1.sd <- sd( na.omit(T.df[(T.df$hhID %in% ids ) , v1] ))
if (length(ids) == 1) {  v1.m <- T.df[(T.df$hhID %in% ids ) , v1]
v1.sd <- 0}
v1.m <- round( v1.m , 1)
v1.sd <- round( v1.sd , 1)
v1.d <- str_c(v1.m , insert , v1.sd )
v1.dat <- append(v1.dat ,  v1.d )
# Variable 2
v2.m <- mean( na.omit(T.df[(T.df$hhID %in% ids ), v2] ))
v2.sd <- sd( na.omit(T.df[(T.df$hhID %in% ids ) , v2] ))
if (length(ids) == 1) {  v2.m <- T.df[(T.df$hhID %in% ids ) , v2]
v2.sd <- 0}
v2.m <- round( v2.m , 2)
v2.sd <- round( v2.sd , 2)
v2.d <- str_c(v2.m , insert , v2.sd )
v2.dat <- append(v2.dat ,  v2.d )
# Variable 3
v3.m <- mean( na.omit(T.df[(T.df$hhID %in% ids ) , v3] ))
v3.sd <- sd( na.omit(T.df[(T.df$hhID %in% ids ) , v3] ))
if (length(ids) == 1) {  v3.m <- T.df[(T.df$hhID %in% ids ) , v3]
v3.sd <- 0}
v3.m <- round( v3.m , 0)
v3.sd <- round( v3.sd , 0)
v3.d <- str_c(v3.m , insert , v3.sd )
v3.dat <- append(v3.dat ,  v3.d )
# Variable 4
v4.m <- 100* mean( na.omit(T.df[(T.df$hhID %in% ids ) , v4] ))
v4.sd <- 100*sd( na.omit(T.df[(T.df$hhID %in% ids ) , v4] ))
if (length(ids) == 1) {  v4.m <- T.df[(T.df$hhID %in% ids ) , v4]
v4.sd <- 0}
v4.m <- round( v4.m , 0)
v4.sd <- round( v4.sd ,0)
v4.d <- str_c(v4.m )
v4.dat <- append(v4.dat ,  v4.d )
}
v1.dat <-  v1.dat[ -c(1)]
v2.dat <-  v2.dat[ -c(1)]
v3.dat <-  v3.dat[ -c(1)]
v4.dat <-  v4.dat[ -c(1)]
dat <- cbind(
v3.dat,
v2.dat,
v1.dat,
v4.dat
)
cli.dat <- rbind(cli.dat,dat)
}
cli.dat <- cli.dat[-c(1),]
# cli.dat <- na.omit(cli.dat)
colnames(cli.dat) = c('Altitude',
'Max temp',
'Rainfall',
'Water logging')
path_out = '.\\Figures.out\\'
fileName = paste(path_out, 'table_typology_clim.csv',sep = '')
write.csv.utf8.BOM(  cli.dat  ,   file =   fileName )  # Export
#View(cli.dat)
}
tb.typ.clim()
# ~ ~ ADDITIONAL TYPOLOGY SUMMARY FIGURES
# ~ Biomass figure
biom.tree.bio <- function(){
# TREE BIOMASS FIGURES
#organics.tree.all <- data.frame()
organics.tree.all <- organics.tree
organics.tree.all <-   rbind(organics.tree , c( seq(0,0, length.out = (ncol(organics.tree)))))
mn.cc.biom.Mg <- mean(na.omit(comp[,'Biomass.per.tree.cc.tree.Mg']))
mn.cc.biom.Mg.sd <- .2
cocoa.row.number <- nrow(organics.tree.all)
row.names(organics.tree.all)[cocoa.row.number] <- 'Theobroma cacao'
organics.tree.all[cocoa.row.number,'tree.name'] <- "Cocoa"
organics.tree.all[cocoa.row.number,'sci.name'] <- "Theobroma cacoa"
organics.tree.all[cocoa.row.number,'Tree.type'] <- 'Evergreen'
organics.tree.all[cocoa.row.number,'total.biomass.Mg.per.tree'] <- as.numeric(mn.cc.biom.Mg)
organics.tree.all[cocoa.row.number,'total.volume.m3.sd.frac'] <- as.numeric(mn.cc.biom.Mg.sd )
organics.tree.all
#colnames(organics.tree)
organics.tree.all$total.biomass.Mg.per.tree <- as.numeric(organics.tree.all$total.biomass.Mg.per.tree)
organics.tree.all$total.biomass.Mg.per.tree.sd.frac <- as.numeric(organics.tree.all$total.volume.m3.sd.frac)
organics.tree.all$total.biomass.Mg.per.tree.sd.abs <- (organics.tree.all$total.biomass.Mg.per.tree.sd.frac * organics.tree.all$total.biomass.Mg.per.tree)
tree.type.order <- c('Evergreen' , 'Deciduous')
organics.tree.all <- organics.tree.all[ order(organics.tree.all$total.biomass.Mg.per.tree),]
organics.tree.all[,'sci.name'] <-  factor(organics.tree.all[,'sci.name'] , levels = organics.tree.all[,'sci.name'])
organics.tree.all[,'Tree.type'] <- factor(organics.tree.all[,'Tree.type'] , levels = tree.type.order)
tree.sizes.x.tick.fs <- 9.5
tree.sizes.bar.width <-  0.4275
tree.sizes.error.bar.width <-  0.24885
tree.sizes.error.bar.size <- 0.37
tree.sizes.y.tit.fs <- 10.5
tree.sizes.y.ticks.fs <- 9
tree.sizes.error.bar.color <-  error.bar.color
tree.fig.strip.fs <- 10
fig.tree.mass.p.mg.top <- 0.35
fig.tree.mass.p.mg.bottom <- 0.35
fig.tree.mass.p.mg.right <- 0.35
fig.tree.mass.p.mg.left <- 0.25
fig.tree.mass.b <<- ggplot(organics.tree.all, aes(x = sci.name, y = total.biomass.Mg.per.tree)) +
geom_bar(stat="identity", fill= bar.color, colour =  bar.color.border  , width =  tree.sizes.bar.width ,  position = position_dodge() ,  lwd = fig.yd.bp.thickness )+
xlab('')+
# coord_flip() +
geom_errorbar(aes(ymin = total.biomass.Mg.per.tree - (total.biomass.Mg.per.tree.sd.abs  ), ymax = total.biomass.Mg.per.tree +  total.biomass.Mg.per.tree.sd.abs , x = sci.name, group = sci.name) , width=  tree.sizes.error.bar.width , size =   tree.sizes.error.bar.size ,  position=position_dodge()
,color = tree.sizes.error.bar.color) +
#scale_y_reverse(limits = c(100, 0))+
ylab(bquote('Mature tree biomass (Mg  '*tree^-1*') ')) +
facet_wrap( Tree.type  ~ ., ncol = 2, nrow = 1 , scales = 'free_x' )   +
force_panelsizes(cols = c(.8, 1)) +
scale_y_continuous(breaks=seq(0,60,10) , labels = scales::number_format(accuracy = 1.0))+
# labels = scales::number_format(accuracy = 1.0))+
scale_x_discrete(limits = rev(levels('sci.name')))+
theme(
plot.margin = unit(c(  fig.tree.mass.p.mg.top ,
fig.tree.mass.p.mg.right,
fig.tree.mass.p.mg.bottom*0 -.4,
fig.tree.mass.p.mg.left), "cm"),
axis.ticks.y = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_text(angle = 270.0, vjust = 0.5, hjust=0.5, size = tree.sizes.y.ticks.fs , face = 'italic'),
# axis.text.y = element_text( vjust = 0.5, hjust = 1, size =   tree.sizes.x.tick.fs , face = 'italic'),
#  axis.text.x = element_text(vjust = 0.5, hjust=0.5, size = tree.sizes.y.ticks.fs ),
#    axis.title.y = element_text(vjust = 0.5, hjust=0.5, size = tree.sizes.y.tit.fs ),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.title.y = element_text(size =   tree.sizes.y.tit.fs),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
#   axis.text.x = element_blank(),
strip.text.x = element_text(size =  tree.fig.strip.fs, color = 'black'),
#  strip.text.x = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggsave("Fig_tree_mass.jpeg", fig.tree.mass.b  , path = "Figures.out", width=600, height=800, units="px", scale=2.5)
}
biom.tree.bio()
# COMPARTMENT SPECIFIC BIOMASS
fig.carbon <- function(){
# Compartment C sequestration
C.remv.sum  <- data.frame()
var.names <- c ('CO2.Mg.ha.yr',
'compartment',
'system')
comp[comp$cc.plot.sys == 'Traditional' & !is.na(comp$cc.plot.sys) ,'cc.plot.sys'] <- 'Amazonia'
length.hysn <- nrow((comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid sun' & !is.na(comp$cc.plot.sys) , ]))
length.hysh <-nrow((comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid shade' & !is.na(comp$cc.plot.sys) , ]))
length.amaz <-nrow((comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Amazonia' & !is.na(comp$cc.plot.sys) , ]))
total.row <- length.hysn + length.hysh + length.amaz
rows <- seq(1:total.row)
C.remv.sum <- data.frame(  matrix(ncol = length(var.names), nrow = length(rows) , dimnames=list(rows  , var.names  )))
# Cocoa
var <- 'lc.Biomass.CO2.remv.cc.cocoa.total.Mg.ha.yr'
sc.2.min <- length.hysn +1
sc.2.max <- sc.2.min  + length.hysh - 1
sc.3.min <- sc.2.max + 1
sc.3.max <- sc.3.min  + length.amaz - 1
C.remv.sum[1:length.hysn, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid sun' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.2.min:sc.2.max  , 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid shade' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.3.min:sc.3.max , 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Amazonia' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[1:length.hysn, 'compartment'] <- 'Cocoa trees'
C.remv.sum[(sc.2.min ):sc.2.max, 'compartment'] <- 'Cocoa trees'
C.remv.sum[sc.3.min:sc.3.max, 'compartment'] <- 'Cocoa trees'
C.remv.sum[1:length.hysn, 'system'] <- 'Hybrid sun'
C.remv.sum[(sc.2.min ):sc.2.max, 'system'] <- 'Hybrid shade'
C.remv.sum[sc.3.min:sc.3.max, 'system'] <- 'Amazonia'
#View(C.remv.sum)
# Shade
var <- 'lc.Biomass.CO2.remv.cc.shade.total.Mg.ha.yr'
min.hysn <- max.hysn+ 1
min.hysh <- max.hysh  + 1
min.amaz <- max.amaz + 1
max.hysn <- min.hysn + length.hysn -1
max.hysh <- min.hysh + length.hysh - 1
max.amaz <- min.amaz + length.amaz -1
sc.1.min <- sc.3.max  +1
sc.1.max <- sc.1.min  + length.hysn -1
sc.2.min <- sc.1.max + 1
sc.2.max <- sc.2.min  + length.hysh - 1
sc.3.min <- sc.2.max + 1
sc.3.max <- sc.3.min  + length.amaz - 1
C.remv.sum[sc.1.min:sc.1.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid sun' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.2.min:sc.2.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid shade' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.3.min:sc.3.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Amazonia' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.1.min:sc.1.max, 'compartment'] <- 'Shade trees'
C.remv.sum[sc.2.min:sc.2.max, 'compartment'] <- 'Shade trees'
C.remv.sum[sc.3.min:sc.3.max, 'compartment'] <- 'Shade trees'
C.remv.sum[sc.1.min:sc.1.max, 'system'] <- 'Hybrid sun'
C.remv.sum[sc.2.min:sc.2.max, 'system'] <- 'Hybrid shade'
C.remv.sum[sc.3.min:sc.3.max, 'system'] <- 'Amazonia'
# Intercrop
var <- 'lc.Biomass.CO2.remv.cc.interc.total.Mg.ha.yr'
min.hysn <- max.hysn +1
min.hysh <- max.hysh+ 1
min.amaz <- max.amaz+ 1
max.hysn <- min.hysn + length.hysn -1
max.hysh <- min.hysh + length.hysh - 1
max.amaz <- min.amaz + length.amaz -1
sc.1.min <- sc.3.max  +1
sc.1.max <- sc.1.min  + length.hysn -1
sc.2.min <- sc.1.max + 1
sc.2.max <- sc.2.min  + length.hysh - 1
sc.3.min <- sc.2.max + 1
sc.3.max <- sc.3.min  + length.amaz - 1
C.remv.sum[sc.1.min:sc.1.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid sun' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.2.min:sc.2.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid shade' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.3.min:sc.3.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Amazonia' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.1.min:sc.1.max, 'compartment'] <- 'Annual crops'
C.remv.sum[sc.2.min:sc.2.max, 'compartment'] <- 'Annual crops'
C.remv.sum[sc.3.min:sc.3.max, 'compartment'] <- 'Annual crops'
C.remv.sum[sc.1.min:sc.1.max, 'system'] <- 'Hybrid sun'
C.remv.sum[sc.2.min:sc.2.max, 'system'] <-  'Hybrid shade'
C.remv.sum[sc.3.min:sc.3.max, 'system'] <- 'Amazonia'
# Fruit/other
var <- 'lc.Biomass.CO2.remv.cc.fruit.total.Mg.ha.yr'
min.hysn <- max.hysn +1
min.hysh <- max.hysh+ 1
min.amaz <- max.amaz+ 1
max.hysn <- min.hysn + length.hysn -1
max.hysh <- min.hysh + length.hysh - 1
max.amaz <- min.amaz + length.amaz -1
sc.1.min <- sc.3.max  +1
sc.1.max <- sc.1.min  + length.hysn -1
sc.2.min <- sc.1.max + 1
sc.2.max <- sc.2.min  + length.hysh - 1
sc.3.min <- sc.2.max + 1
sc.3.max <- sc.3.min  + length.amaz - 1
C.remv.sum[sc.1.min:sc.1.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid sun' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.2.min:sc.2.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Hybrid shade' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.3.min:sc.3.max, 'CO2.Mg.ha.yr'] <- comp[comp$cm_crop == 1 & comp$cc.plot.sys == 'Amazonia' & !is.na(comp$cc.plot.sys) , var]
C.remv.sum[sc.1.min:sc.1.max, 'compartment'] <- 'Other trees'
C.remv.sum[sc.2.min:sc.2.max, 'compartment'] <- 'Other trees'
C.remv.sum[sc.3.min:sc.3.max, 'compartment'] <- 'Other trees'
C.remv.sum[sc.1.min:sc.1.max, 'system'] <- 'Hybrid sun'
C.remv.sum[sc.2.min:sc.2.max, 'system'] <- 'Hybrid shade'
C.remv.sum[sc.3.min:sc.3.max, 'system'] <- 'Amazonia'
ordered.compartments <- c('Annual crops',
'Cocoa trees',
'Shade trees',
'Other trees')
C.remv.sum[ , 'system'] <- factor (C.remv.sum[ , 'system'] , ordered.typologies)
C.remv.sum[ , 'compartment'] <- factor (C.remv.sum[ , 'compartment'] , ordered.compartments)
#View(C.remv.sum)
CO2r.bar.width <- compart.bmass.bar.width
fig.co2r.x.axis.fs <- 9
y.tit.sz <- 10
fig.co2r.facet.tx.size <- 10.5
box.plot.color <<- '#4a646c'
box.plot.fill.color <<- '#a9a9a9'
fig.compart.CO2r <<- ggplot( data = C.remv.sum ,  aes(x = system , y = CO2.Mg.ha.yr  )) +
#  geom_bar(data = C.remv.sum[ !(C.remv.sum$compartments == 'Total') , ]  , stat = "identity", fill = bar.color , colour =  bar.color.border  , width =  CO2r.bar.width ,  position = position_dodge())+
xlab('')+
geom_boxplot(data = C.remv.sum  ,aes(y = CO2.Mg.ha.yr    ,  x = system ), outlier.shape = NA, coef = 5 , color = box.plot.color, fill = box.plot.fill.color , alpha= 0.5 , lwd = fig.yd.bp.thickness , fatten = fig.yd.bp.fatten)+
ylab(bquote('Carbon dioxide removal (Mg  '*CO[2]*' '*ha^-1*' '*yr^-1*')'))+
facet_wrap( compartment ~ . , ncol = 4, nrow = 1, scales = 'free_x' )   +
scale_y_continuous(breaks = seq(-15,0,3),limit = c(-15,0) ,  labels = scales::number_format(accuracy = 1.0))+
theme(
plot.margin = unit(c(p.mg.top,p.mg.right,-.3,p.mg.left), "cm"),
axis.ticks.x = element_blank(),
axis.text.x = element_text(angle = x.tick.angle , vjust = 0.5, hjust=0.5, size = fig.co2r.x.axis.fs ),
# axis.text.x = element_blank(),
axis.text.y = element_text(vjust = 0.5, hjust=0.5, size = fig.co2r.y.tick.sz ),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.title.y = element_text(size =  fig.co2r.y.tit.sz),
strip.text.x = element_text(size =  facet.tx.size, color = 'black'),
strip.background = element_rect(color='black', fill='white', size=1.0, linetype="solid"),
panel.border = element_rect(colour = "black", fill=NA, size=1)
)
fig.compart.CO2r
#fig.compart.CO2r <<-  annotate_figure(fig.compart.CO2r.b,   fig.lab = "b", fig.lab.pos ="top.left", fig.lab.size = fig.lab.fs, fig.lab.face = 'bold')
#fig.bio.1 <<- plot_grid( fig.tree.mass ,   biom.incr ,  align = "v", nrow = 1, ncol = 2 ,  rel_heights = c(50/100,  50/100) , rel_widths = c(60/100,  38/100) )
#fig.bio.2 <<- plot_grid(  fig.compart.bmass , fig.compart.CO2r,  align = "h", nrow = 2, ncol = 1 ,  rel_heights =   c(36/100,  50/100)   )
#ggsave("fig.bio.C.jpeg", fig.bio.2   , path = "Figures.out", width=620, height=750, units="px", scale=2.5)
ggsave("fig.compart.CO2r.jpeg", fig.compart.CO2r   , path = "Figures.out", width=710, height=390, units="px", scale=2.5)
}
fig.carbon()
fig.compart.CO2r
# Export all typology data as one excel file
cols.to.include <- vr.list
Typ.data <- comp[!is.na(comp$typ)   , c('typ' ,'typology' , 'hhID' , cols.to.include) ]
climatic.vars <- c('elev',
'temp',
'precip',
'temp.mmm',
'cv_precip'
)
for (v in climatic.vars){
col.name <- str_c('col.',v)
new.column <- 0
for (r in 1:nrow(Typ.data)){
cid <- Typ.data[r, 'hhID' ]
new.column <- append (new.column , bioclim.df[bioclim.df$hhID == cid , v ])
}
new.column <- new.column[-c(1)]
Typ.data <- cbind(Typ.data  , new.column )
colnames(Typ.data)[ncol((Typ.data))] <- v
setwd(main.dir)
}
names(Typ.data)[names(Typ.data) == 'elev'] <- 'Elevation.m.asl'
names(Typ.data)[names(Typ.data) == 'temp'] <- 'Temperature'
names(Typ.data)[names(Typ.data) == 'precip'] <- 'Rainfall'
names(Typ.data)[names(Typ.data) == 'temp.mmm'] <- 'Temp.mean.max.month'
names(Typ.data)[names(Typ.data) == 'cv_precip'] <- 'Rainfall.cv'
path_out = '.\\Figures.out\\'
Typology.data.file.name = paste(path_out,'Typology_data.csv',sep = '')
write.csv(T.df, Typology.data.file.name)
write.csv(Typ.data  , Typology.data.file.name )
#"
# Script used for assessing means, standard deviations of variables per cluster
#  var <- 'total_N_fert_applied_Mg_per_ha'
#  var <- 'total_non_N_fert_applied_Mg_per_ha'
#  var <- 'plot.quant.shade.trees'
#  var <- 'num_other_crops'
#  var <- 'path.contr.cc.vir.org'
#  var <- 'path.contr.cc.bact.org'
#  var <- 'prunes_per_year'
#  var <- 'weeds_per_year'
#  var <- 'temp1_2'
var <- 'total.costs.usd.per.ha'
var <- 'yld_pc_attain_plot'
var <- 'cc.yd.lc.mn.Mg.ha'
var <-  'total_N_fert_applied_kg_per_ha'
var <-  'total_ammon_nitrate_Nitr_applied_kg_per_ha'
var <-  'total_ammon_Nitr_applied_kg_per_ha'
var <-  'total_nitrate_Nitr_applied_kg_per_ha'
var <-  'total_urea_Nitr_applied_kg_per_ha'
var <- 'pollination.bool'
var <- 'plot.quant.shade.trees.ha'
var <- 'lc.N2O.synthetic.total.Mg.CO2eq'
var <- 'lc.N2O.organic.total.Mg.CO2eq'
var <- 'lc.Biomass.CO2.remv.cc.shade.total.Mg.ha.yr'
var <- 'lc.Biomass.CO2.remv.cc.cocoa.total.Mg.ha.yr'
var <- 'lc.Biomass.CO2.remv.cc.fruit.total.Mg.ha.yr'
var <- 'lc.Biomass.CO2.remv.cc.interc.total.Mg.ha.yr'
#var <- 'elev'
# var <- 'precip'
#  var <- 'insecti.app.cocoa'
#  var <- 'fungi.app.cocoa'
# var <- 'herbi.app.cocoa'
# var <- 'pollination.bool'
var <- 'lc.GHG.remv.cc.Mg.CO2eq.ha.yr'
var <- 'lc.N2O.Mg.total.Mg.CO2eq'
var <- 'lc.net.VOP.1000.usd.per.ha'
var <- 'lc.GHG.remv.C.Mg.CO2eq'
var <- 'lc.net.VOP.frac.cc'
var <- 'gross.revenue.usd.per.ha.frac.cc'
var <- 'gross.revenue.usd.per.ha.frac.ann.crop'
var <- 'gross.revenue.usd.per.ha.frac.frt'
var <- 'gross.revenue.usd.per.ha.frac.ag.cmd'
var <- 'gross.revenue.usd.per.ha.frac.fuelw'
var <- 'gross.revenue.usd.per.ha.frac.hardw'
dat <- hc.hysh
dat <- hc.amaz
dat <- hc.hysun
typ <- 'Hybrid shade'
typ <- 'Hybrid sun'
typ <- 'Amazonia'
comp$typ.str == 5 & !is.na(comp$typ.str) & comp$typology == 'Amazonia'
nrow( dat[ dat$cluster ==1, ])
nrow( dat[ dat$cluster==2, ])
nrow( dat[ dat$cluster==3, ])
nrow( dat[ dat$cluster==4, ])
nrow( dat[ dat$cluster==5, ])
nrow( dat[ dat$cluster==6, ])
summary(comp[ comp$typ.str == 1 & comp$typology ==typ & !is.na(comp$typ.str),var])
summary(comp[ comp$typ.str == 2 & comp$typology ==typ & !is.na(comp$typ.str),var])
summary(comp[ comp$typ.str == 3 & comp$typology ==typ & !is.na(comp$typ.str),var])
summary(comp[ comp$typ.str == 4 & comp$typology ==typ & !is.na(comp$typ.str),var])
summary(comp[ comp$typ.str == 5 & comp$typology ==typ & !is.na(comp$typ.str),var])
# GHG deviations
5.916/4.8  # shade   # system average 5.2
4.392 / 3.3 # sun  system average 3.6
2.15/1.58  # amazonia system average 1.8
5.2/1.8
# Summary statistics, by omision
summary(comp[ comp$typ.str != 5 & comp$typology ==typ & !is.na(comp$typ.str),var])
0.8226 /0.35793
# SD as percentage
sd(na.omit(comp[ comp$typ.str == 1 & comp$typology ==typ ,var])) /mean(na.omit(comp[ comp$typ.str == 1 & comp$typology ==typ ,var]))
sd(na.omit(comp[ comp$typ.str == 2 & comp$typology ==typ ,var]))/mean(na.omit(comp[ comp$typ.str == 2 & comp$typology ==typ ,var]))
sd(na.omit(comp[ comp$typ.str == 3 & comp$typology ==typ ,var]))/mean(na.omit(comp[ comp$typ.str == 3 & comp$typology ==typ ,var]))
sd(na.omit(comp[ comp$typ.str == 4 & comp$typology ==typ ,var]))/mean(na.omit(comp[ comp$typ.str == 4 & comp$typology ==typ ,var]))
sd(na.omit(comp[ comp$typ.str == 5 & comp$typology ==typ ,var]))/mean(na.omit(comp[ comp$typ.str == 5 & comp$typology ==typ ,var]))
sd(na.omit(comp[ comp$typology ==typ ,var]))/mean(na.omit(comp[  comp$typology ==typ ,var]))
summary(comp[ comp$typology == typ & !is.na(comp$typ),var])
sd(na.omit(comp[ comp$typology == typ & !is.na(comp$typ),var]))
5.2/3.6
5.2/1.7545
5.2-1.75
# cost disaggregation
# Sun 149 #
# Shade 144 #
# Amazonia 133 #
#GHG disaggregation
# N2O as fract CO2 removal
# sun    .141/1.895
# shade         .272/-5.473
# amazonia        .18  /-3.7710
# Shade as frac total co2 removal
# sun     /1.895
# shade        3.4 /5.473
# amazonia       2.3  /3.7710
# cocoa biomass as frac total co2 removal
# sun     1.8/1.895
# shade        1.9 /5.473
# amazonia     1.47   /3.7710
2295/1000 /(7.2 * 3.67)
# Production system based on omission
summary(comp[ comp$typology != typ & !is.na(comp$typ),var])
sd(na.omit(comp[ comp$typology != typ & !is.na(comp$typ),var]))
1.5/1.2
# all systems
summary(comp[  !is.na(comp$typ),var])
sd(na.omit(comp[  !is.na(comp$typ),var]))
fig.vop
#summary(comp[ comp$hhID %in%  dat[ dat$typ ==1  ,'hhID'],var])
#summary(comp[ comp$hhID %in%  dat[ dat$typ==2 ,'hhID'],var])
#summary(comp[ comp$hhID %in%  dat[ dat$cluster==3 ,'hhID'],var])
#summary(comp[ comp$hhID %in%  dat[ dat$cluster==4  ,'hhID'],var])
#summary(comp[ comp$hhID %in%  dat[ dat$cluster==5 ,'hhID'],var])
sd(na.omit(comp[ comp$hhID %in%  dat[ dat$typ.str==1 & dat$typology == typ ,'hhID'],var]))
sd(na.omit(comp[ comp$hhID %in%  dat[ dat$typ.str==2 & dat$typology == typ ,'hhID'],var]))
sd(na.omit(comp[ comp$hhID %in%  dat[ dat$typ.str==3 & dat$typology == typ ,'hhID'],var]))
sd(na.omit(comp[ comp$hhID %in%  dat[ dat$typ.str==4 & dat$typology == typ ,'hhID'],var]))
sd(na.omit(comp[ comp$hhID %in%  dat[ dat$typ.str==5 & dat$typology == typ ,'hhID'],var]))
nrow(comp[ comp$typology != typ & !is.na(comp$typ) & comp$plot.quant.shade.trees.ha >25 ,])
fig.yd
fig.vop
#"
comp <<- comp
setwd(main.dir)
}  # END TYPOLOGY CODE
run.typology()
fig.vop # ideal dimensions 860, 390
